<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AudioEngine Headless Demo</title>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: rgba(30, 30, 45, 0.8);
            --accent: #00d4ff;
            --accent-secondary: #ff00aa;
            --success: #00ff88;
            --error: #ff4444;
            --text: #ffffff;
            --text-dim: #8888aa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            padding: 2rem;
            background-image: 
                radial-gradient(ellipse at top, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(255, 0, 170, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .info-box {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            text-align: left;
        }

        .info-box h3 {
            color: var(--accent);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .info-box ul {
            margin-left: 1.5rem;
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        button {
            padding: 1rem 2rem;
            font-size: 1rem;
            font-family: inherit;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            border-color: var(--accent);
            background: rgba(0, 212, 255, 0.1);
        }

        .btn-success {
            background: var(--success);
            color: var(--bg-dark);
        }

        .btn-success:hover:not(:disabled) {
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.4);
        }

        .console {
            background: #0d0d12;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: 2rem;
        }

        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .console-title {
            color: var(--accent);
            font-size: 0.9rem;
        }

        .clear-btn {
            padding: 0.3rem 0.8rem;
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-dim);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .clear-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .console-output {
            white-space: pre-wrap;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .log-line {
            padding: 2px 0;
        }

        .log-info { color: var(--text); }
        .log-success { color: var(--success); }
        .log-error { color: var(--error); }
        .log-warn { color: #ffaa00; }
        .log-header { 
            color: var(--accent); 
            font-weight: bold;
            border-top: 1px solid rgba(0, 212, 255, 0.3);
            margin-top: 0.5rem;
            padding-top: 0.5rem;
        }

        .status-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .status-card {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .status-card h3 {
            color: var(--text-dim);
            font-size: 0.8rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .status-value {
            font-size: 1.5rem;
            color: var(--accent);
        }

        .status-value.success { color: var(--success); }
        .status-value.error { color: var(--error); }

        .pad-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .mini-pad {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: var(--text-dim);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mini-pad.loaded {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--accent);
            color: var(--accent);
        }

        .mini-pad:hover {
            transform: scale(1.05);
        }

        .mini-pad.playing {
            animation: padPulse 0.3s ease;
            background: var(--accent);
            color: var(--bg-dark);
        }

        @keyframes padPulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        .preset-select {
            padding: 0.8rem 1rem;
            font-size: 1rem;
            font-family: inherit;
            background: var(--bg-card);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            min-width: 200px;
        }

        .preset-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        footer {
            text-align: center;
            color: var(--text-dim);
            font-size: 0.8rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:28px;height:28px;vertical-align:middle;margin-right:10px"><circle cx="5.5" cy="17.5" r="2.5"/><circle cx="17.5" cy="15.5" r="2.5"/><path d="M8 17V5l12-2v10"/></svg>AudioEngine Headless Demo</h1>
            <p class="subtitle">Proving the audio engine works without any GUI dependencies</p>
            
            <div class="info-box">
                <h3>What this demonstrates:</h3>
                <ul>
                    <li>AudioEngine class has ZERO DOM dependencies</li>
                    <li>All audio operations work via pure JavaScript API calls</li>
                    <li>GUI is completely decoupled - only calls engine methods</li>
                    <li>Engine can be used in any context (CLI, Node.js, tests, etc.)</li>
                </ul>
            </div>
        </header>

        <div class="status-panel">
            <div class="status-card">
                <h3>Engine State</h3>
                <div class="status-value" id="engineState">Uninitialized</div>
            </div>
            <div class="status-card">
                <h3>Loaded Sounds</h3>
                <div class="status-value" id="loadedCount">0 / 16</div>
            </div>
            <div class="status-card">
                <h3>Test Results</h3>
                <div class="status-value" id="testResults">-</div>
            </div>
            <div class="status-card">
                <h3>Pad Status</h3>
                <div class="pad-grid" id="padGrid">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" id="btnInit" onclick="initEngine()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;vertical-align:middle;margin-right:6px"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>Initialize Engine
            </button>
            <button class="btn-secondary" id="btnTest" onclick="runTest()" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;vertical-align:middle;margin-right:6px"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>Run Headless Test
            </button>
            <select class="preset-select" id="presetSelect" onchange="loadSelectedPreset()" disabled>
                <option value="">-- Select Preset --</option>
            </select>
            <button class="btn-success" id="btnPlayAll" onclick="playAllSounds()" disabled>
                <svg viewBox="0 0 24 24" fill="currentColor" stroke="none" style="width:16px;height:16px;vertical-align:middle;margin-right:6px"><polygon points="5 3 19 12 5 21 5 3"/></svg>Play All Sounds
            </button>
        </div>

        <div class="console">
            <div class="console-header">
                <span class="console-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;vertical-align:middle;margin-right:6px"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>Console Output</span>
                <button class="clear-btn" onclick="clearConsole()">Clear</button>
            </div>
            <div class="console-output" id="consoleOutput"></div>
        </div>

        <footer>
            <p>AudioEngine v1.0 - Headless Architecture Demo</p>
            <p>This page demonstrates that the audio engine is fully decoupled from any GUI code.</p>
        </footer>
    </div>

    <!-- Load only the AudioEngine - no other dependencies! -->
    <script src="/js/audioEngine.js"></script>
    
    <script>
        // Global engine instance
        let engine = null;

        // Custom console that displays in the page
        const consoleOutput = document.getElementById('consoleOutput');
        
        function logToConsole(message, type = 'info') {
            const line = document.createElement('div');
            line.className = `log-line log-${type}`;
            line.textContent = message;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // Override console methods to capture AudioEngine logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
            
            if (message.includes('===')) {
                logToConsole(message, 'header');
            } else if (message.includes('[PASS]') || message.includes('[OK]')) {
                logToConsole(message, 'success');
            } else if (message.includes('[FAIL]') || message.includes('[Error]')) {
                logToConsole(message, 'error');
            } else {
                logToConsole(message, 'info');
            }
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            logToConsole(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToConsole(args.join(' '), 'warn');
        };

        // Initialize mini pad grid
        function initPadGrid() {
            const padGrid = document.getElementById('padGrid');
            padGrid.innerHTML = '';
            for (let i = 0; i < 16; i++) {
                const pad = document.createElement('div');
                pad.className = 'mini-pad';
                pad.id = `mini-pad-${i}`;
                pad.textContent = i;
                pad.onclick = () => playPad(i);
                padGrid.appendChild(pad);
            }
        }

        // Update pad grid display
        function updatePadGrid() {
            if (!engine) return;
            
            let loadedCount = 0;
            for (let i = 0; i < 16; i++) {
                const pad = document.getElementById(`mini-pad-${i}`);
                if (engine.hasSound(i)) {
                    pad.classList.add('loaded');
                    loadedCount++;
                } else {
                    pad.classList.remove('loaded');
                }
            }
            
            document.getElementById('loadedCount').textContent = `${loadedCount} / 16`;
        }

        // Play a specific pad
        function playPad(index) {
            if (!engine || !engine.hasSound(index)) return;
            
            const pad = document.getElementById(`mini-pad-${index}`);
            pad.classList.add('playing');
            setTimeout(() => pad.classList.remove('playing'), 300);
            
            engine.playSound(index);
        }

        // Initialize the engine
        async function initEngine() {
            logToConsole('\n[Init] Creating new AudioEngine instance...', 'info');
            engine = new AudioEngine();
            
            logToConsole('[Init] Calling engine.init() - NO GUI CODE INVOLVED', 'info');
            const success = await engine.init();
            
            if (success) {
                document.getElementById('engineState').textContent = engine.getState();
                document.getElementById('engineState').className = 'status-value success';
                document.getElementById('btnTest').disabled = false;
                document.getElementById('presetSelect').disabled = false;
                
                // Fetch presets
                logToConsole('\n[Presets] Fetching presets from API...', 'info');
                const presets = await engine.fetchPresets();
                
                const select = document.getElementById('presetSelect');
                select.innerHTML = '<option value="">-- Select Preset --</option>';
                presets.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = `${p.name} (${p.category})`;
                    select.appendChild(option);
                });
                
                logToConsole(`[OK] Found ${presets.length} presets`, 'success');
            } else {
                document.getElementById('engineState').textContent = 'Failed';
                document.getElementById('engineState').className = 'status-value error';
            }
            
            updatePadGrid();
        }

        // Run the headless test
        async function runTest() {
            if (!engine) return;
            
            logToConsole('\n', 'info');
            const presetId = document.getElementById('presetSelect').value || null;
            const results = await engine.runHeadlessTest(presetId);
            
            const testResults = document.getElementById('testResults');
            testResults.textContent = `${results.passed}/${results.summary.total}`;
            testResults.className = results.failed === 0 ? 'status-value success' : 'status-value error';
            
            updatePadGrid();
            
            if (engine.buffers.some(b => b !== null)) {
                document.getElementById('btnPlayAll').disabled = false;
            }
        }

        // Load selected preset
        async function loadSelectedPreset() {
            if (!engine) return;
            
            const presetId = document.getElementById('presetSelect').value;
            if (!presetId) return;
            
            logToConsole(`\n[Preset] Loading preset: ${presetId}`, 'info');
            const success = await engine.loadPreset(presetId);
            
            if (success) {
                document.getElementById('btnPlayAll').disabled = false;
            }
            
            updatePadGrid();
        }

        // Play all loaded sounds
        function playAllSounds() {
            if (!engine) return;
            
            logToConsole('\n[Play] Playing all loaded sounds...', 'info');
            
            for (let i = 0; i < 16; i++) {
                if (engine.hasSound(i)) {
                    setTimeout(() => {
                        playPad(i);
                    }, i * 200); // Stagger playback
                }
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initPadGrid();
            logToConsole('[Ready] Headless Demo Ready', 'success');
            logToConsole('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'info');
            logToConsole('This demo proves that AudioEngine works independently.', 'info');
            logToConsole('The engine has ZERO GUI dependencies.', 'info');
            logToConsole('All operations are pure API calls.', 'info');
            logToConsole('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'info');
            logToConsole('\nClick "Initialize Engine" to begin...', 'info');
        });
    </script>
</body>
</html>
